---
title: "V2_TabularData_univar_Ex1"
author: "Vitalii Zakhozhyi"
---

```{r getData, eval=FALSE}
link='https://github.com/EvansDataScience/VisualAnalytics_2_tabularData/raw/master/data/eduwa.rda'
#getting the data TABLE from the file in the cloud:
load(file=url(link))
```

```{r column_Names, eval=FALSE}
names(eduwa)
```

```{r dataSTR, eval=FALSE}
str(eduwa,width = 70,strict.width='cut')
```

```{r head, eval=FALSE}
head(eduwa$LocaleType,50)
```

```{r freqTab_abs, eval=FALSE}
# absolute values
table(eduwa$LocaleType,exclude = 'nothing')
```

```{r freqTab_rel, eval=FALSE}
# relative values
absoluteT=table(eduwa$LocaleType,exclude = 'nothing')

#exclude = 'nothing' - need to add that to show the missing data, otherwise R will not give us the missing data
prop.table(absoluteT) #the proportions table  
```

This table tells us the location of the public schools. What is the right visual for this? Sometimes the answer seems obvious, as tradition or habits give so much weight to decisions. Let's use the very well known **pie chart**:

```{r pieBasic, eval=FALSE}
# the pie plots the table:
ToPlot=prop.table(absoluteT) #saving the result of the prop.table 
pie(ToPlot) #make a pie chart 
```

You should always keep it simple. Then decorate. For example, you can start improving the plot you already *have*:

* The purple sector does not show a label:

```{r namesFre_NA, eval=FALSE}
names(ToPlot)
```

We could alter the fifth label:
```{r alterTable, eval=FALSE}
names(ToPlot)[5]='Unknown'
```

* Our plot did not have a title. Titles (and subtitles) are important. To give a title, it can be a *question* to be answered by the plot:


```{r pieTitle_question, eval=FALSE}
# the pie plots the table:
titleText='Where are Public Schools located in WA in 2019?'
sourceText='Source: US Department of Education'

pie(ToPlot,
    main=titleText, #agrument main means give a title
    sub=sourceText)  #argument sub means sourse
```

The title can *guide* the reader to recognise the purpose of your plot:

```{r pieTitle_guide, eval=FALSE}
# the pie plots the table:
titleText2='WA still has schools locations unknown \n (info from 2018)'

pie(ToPlot,
    main=titleText2,
    sub=sourceText)
```



The title can also *suggest* the decision:

```{r pieTitle_suggestion, eval=FALSE}
# the pie plots the table:
titleText3='WA needs to fully categorize school locations\n(info from 2018)'

#\n will divide the text and bring the rest of the title to the 2nd line

pie(ToPlot,
    main=titleText3,
    sub=sourceText)
```

Titles are no that easy to produce. You need to rewrite them many times, until you find a good combination of words that can be read in less than ten seconds. Is also good to keep in mind that you must never give your audience a cacophonous version (a *tongue twister*), and neither should you include adjectives.

A general rule for any plot is to make it reachable for the audience you are writing to (read [this](https://www.red-gate.com/simple-talk/sysadmin/general/5-steps-to-making-your-boss-read-your-technical-reports/) every day).


Let's do more customization:

* You can use the values as labels. If values between [0,1]  represent shares, it is better to use a [0,100] scale (in %).

```{r 100convert, eval=FALSE}
ToPlot*100
```

* You can customize the colors:

```{r rainbowColor, eval=FALSE}
# details:
ToPlot=ToPlot*100 # preparing labels
paletteHere=rainbow(length(ToPlot)) # customizing set of colors

# plotting
pie(x=ToPlot,#table
    col = paletteHere, 
    labels = ToPlot,
    main=titleText,
    sub=sourceText)

```


The labels need better work:
```{r percentExample, eval=FALSE}
paste0(round(ToPlot,2),'%') #paste0 means that we combine 2 elements but without space between them; paste command will insert space between it 
```

Then,

```{r labelPercent, eval=FALSE}
plotLabels=paste0(round(ToPlot,2),'%') # labels for the slices
# plotting
pie(x=ToPlot,#table
    col = paletteHere, 
    labels = plotLabels,
    main=titleText,
    sub=sourceText)
```

* You may need to use legends, but considering its cluttering effects:
```{r legendPie1, eval=FALSE}
# plotting
pie(x=ToPlot,#table
    col = paletteHere, 
    labels = plotLabels,
    main=titleText,
    sub=sourceText)
#legend
legend(x="right", #where
       legend=names(ToPlot), #text
       fill = paletteHere) #symbols' colors
```

Most  legends need customization:
```{r legendPie2, eval=FALSE}
# MANAGING THE LEGEND:

pie(x=ToPlot,#table
    col = paletteHere, 
    labels = plotLabels,
    main=titleText,
    sub=sourceText)
#legend
legend(x="right", #where
       legend=names(ToPlot), #text
       fill = paletteHere,
       bty = 'n', # no box
       cex = 0.5  # shrink
       ) #symbols' colors
```


Most people tend to use pie charts with categorical data, but this **should not** be the default option to visualize classification (see this [discussion](https://medium.com/geckoboard-under-the-hood/think-before-you-pie-chart-and-more-effective-ways-to-visualize-your-data-862ea3456b26)). Following the advice from the [video](https://www.youtube.com/watch?v=axx_MYb8-SI) in that post, we should turn our pie into a **bar chart**. Let me do it with the same info I used to build the pie:

```{r barplot1, eval=FALSE}

# barplot plots the table too

barplot(ToPlot,
         col = paletteHere,
         main=titleText,
         sub=sourceText) 
```

We saved some space as no legend was needed (the less **ink** the better visual). Speaking of saving, we can get rid of the colors (they were needed to differentiate the slices). 

A very important thing to consider is that axes represent some unit of measurement, so make sure that unit is shown:

```{r barplot2, eval=FALSE}
paletteHereNew=c('gray') # just one color
# plotting
barplot(ToPlot,
     col = paletteHereNew,
     border=NA, #no border
     main=titleText,
     sub=sourceText,
     ylim=c(0,50),  
     ylab = '(in %)' # show unit
     )
```


If you consider **annotating** the plot, you can use the labels we used before:

```{r barplotAnnot, eval=FALSE}
# plotting
location=barplot(ToPlot,
     col = paletteHereNew,
     border=NA,
     main=titleText,
     sub=sourceText,
     ylim=c(0,50),
     ylab = '(in %)')

#annotating
text(x=location,y=ToPlot,labels=plotLabels,
     pos = 1,# if pos=3, text will be on top of bar
     cex = 0.8) 

```


You may decide to change the **orientation** of the plot:


```{r flipBarplot, eval=FALSE}
# plotting
location=barplot(ToPlot,
     col = paletteHereNew,
     border=NA,
     main=titleText,
     sub=sourceText,
     ylim=c(0,50),
     ylab = '(in %)',
     horiz = T) # ORIENTATION T means True, if its F - its False, 

#annotating
text(x=location,y=ToPlot,labels=plotLabels,
     pos = 1) # this is the position of the label

```

The problem above is that changing the orientation, changes the axes. Then, we need to do more work:

```{r flipBarplot2, eval=FALSE}
location=barplot(ToPlot,
         col = paletteHereNew,
         border=NA,
         main=titleText,
         sub=sourceText,
         xlim=c(0,50), #change to xlim
         xlab = '(in %)', #change to xlab
         horiz = T)

#annotating
text(x=ToPlot,y=location, #change of x and y
     labels=plotLabels,
     pos = 4)  # change position of the label
```

A little more work on the categories names:

```{r categoryNames, eval=FALSE}
location=barplot(ToPlot,
         col = paletteHereNew,
         border=NA,
         main=titleText,
         sub=sourceText,
         cex.names = 0.7, #shrink category names
         xlim=c(0,50), 
         xlab = '(in %)', 
         horiz = T)

#annotating
text(x=ToPlot,y=location,labels=plotLabels,pos = 4)  
```


We made the right changes, but some things do not look well. It would be better if:

* The subtitle (_source_) and the label of the x-axis were not that close. A good step will be to have the subtitle as an element of its own, which allows, for instance, to decide its alignment and size:

```{r barSubtitle, eval=FALSE}
location=barplot(ToPlot,
         col = paletteHereNew,
         border=NA,
         main=titleText, # no sub here!
         xlim=c(0,50), 
         cex.names = 0.5,
         xlab = '(in %)', 
         horiz = T)

# annotating
text(x=ToPlot,y=location,labels=plotLabels,pos = 4)  

# subtitle
title(sub=sourceText, 
      adj=0,#adj=1 aligns to rigth.
      cex.sub=0.7) #shrinking text
```

* To have the label of the x-axis closer to the axis itself, we need to alter the _graphical parameters_:

```{r mgp_Barplot, eval=FALSE}
# changing parameters
# (distanceOfUnit To plot, 
# distanceOfAxislabels to plot,
# distance ofTicks to plot)
# default is: mgp=c(3, 1, 0)

par(mgp=c(0.5,0.5,0)) 
#####

location=barplot(ToPlot,
         col = paletteHereNew,
         border=NA,
         main=titleText,
         xlim=c(0,50), 
         xlab = '(in %)',
         cex.names = 0.6,
         cex.lab=0.6, # shrinking label text
         horiz = T) 

text(x=ToPlot,y=location,labels=plotLabels,pos = 4) 

title(sub=sourceText, adj=0,cex.sub=0.7,
      line = 3) #push the text down
```

* It is generally a good idea to add a **reference line**, which can represent an expected value or another relevant value. Since I have four different locations (not considering the missing ones), let me put a line to signal the 25% (uniform share among four locations):

```{r refLine_bar, eval=FALSE}

titleText2='Are all locations getting a fair share of public schools in WA?'


par(mgp=c(1,0.5,0)) 
location=barplot(ToPlot,
         col = paletteHereNew,
         border=NA,
         main=titleText2,
         xlim=c(0,50), 
         cex.names = 0.6,
         cex.lab=0.6,
         xlab = '(in %)',
         horiz = T
         ) 

text(x=ToPlot,y=location,labels=plotLabels,pos = 4) 
title(sub=sourceText, adj=0,cex.sub=0.7,
      line = 3) 

# reference line
abline(v=25,#position vertical
       lty=3,#type
       lwd=3)#width

```

Again, adding another element requires adjusting what we had. What about writing your own axis-values and reducing the bar annotations:

```{r lastPlot_bar, eval=FALSE}

par(mgp=c(1,0.5,0)) 
location=barplot(ToPlot,
         col = paletteHereNew,
         border=NA,
         main=titleText2,
         xlim=c(0,50), 
         xlab = '(in %)',
         cex.names=0.6,
         cex.lab=0.6,
         las=2,
         horiz = T,
         xaxt="n") # no x-axis, so I customize it below...

text(x=ToPlot,y=location,labels=plotLabels,pos = 4,cex = 0.7) 
title(sub=sourceText, adj=0,cex.sub=0.7,line = 3)

#reference line
abline(v=25,lty=3,lwd=3)


# customizing tick values
newXvalues<-c(0,10,25,40,50) # you just want to show this on the axis
axis(side=1, 
     at=newXvalues, #the ticks
     labels = newXvalues, #the numbers of the ticks
     cex.axis=0.8)

```


So far, we have used the _basic_ R capabilities for plotting. 

There are alternative libraries, like **ggplot2**, that are also frequently used. However, it has a different approach, which allows to add layers that let you customize your plot. The classic approach for ggplot is:





<span style="color:red"> Exercise:<br>Use ggplot to show a bar plot ordered by share size.</span>

### Excercise solution

```{r ggplot, eval=FALSE}
tableFreq=as.data.frame(ToPlot) 
names(tableFreq)=c("locale","pct")
tableFreq_Ordered=tableFreq[order(-tableFreq$pct),] #ordering in ggplot
tableFreq_Ordered
```


```{r ggplot1, eval=FALSE}
library(ggplot2)
library(scales)
base=ggplot(data = tableFreq_Ordered,
             aes(x = locale,
                 y = pct))
plot1 = base + geom_bar(fill ="gray",
                        stat = 'identity')
plot2 = plot1 + labs(title=titleText2,
                     x =NULL, 
                     y = NULL,
                     caption = sourceText)
plot3 = plot2 + geom_hline(yintercept = 25,
                           linetype="dashed", 
                           size=1.5, 
                           alpha=0.5)
plot4 = plot3 + scale_y_continuous(breaks=c(0,10, 25,40,50),
                                 limits = c(0, 50),
                                 labels=scales::unit_format(suffix = '%')) 
plot5 = plot4 + theme(panel.background = element_rect(fill = "white",
                                                    colour = "grey50"),
                    plot.caption = element_text(hjust = 0),
                    plot.title = element_text(hjust = 0.5))
plot6 = plot5 + geom_text(aes(y = pct ,
                            label = paste0(round(pct,2), '%')),
                        vjust=1,
                        size = 3)
plot7 = plot6 + coord_flip() + scale_x_discrete(limits=tableFreq_Ordered$locale) #flipping the plot and changing the indexes
plot7
```






